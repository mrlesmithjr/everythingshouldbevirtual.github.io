---
layout: post
title: vSphere iSCSI Datastore Errors
date: 
type: post
published: false
status: draft
categories: []
tags: []
meta:
  _edit_last: '11'
  snap_MYURL: ''
  snapEdIT: '1'
  snapDL: s:102:"a:1:{i:0;a:3:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";}}";
  snapFB: s:253:"a:1:{i:0;a:8:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapLI: s:247:"a:1:{i:0;a:8:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapSU: s:119:"a:1:{i:0;a:4:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";}}";
  snapTW: 's:172:"a:1:{i:0;a:5:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:42:"%TITLE%
    - %URL% #everythingshouldbevirtual";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";}}";'
  _s2mail: 'yes'
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>I have started to see these errors cropping up quite a bit lately since setting up my ELK (Elasticsearch Logstash Kibana) stack for logging. So I figured that I would dig in and see what is going on. Below is the error that I was capturing. (Key errors in <strong>bold</strong>)</p>
<pre>2014-09-20T00:54:33.183Z esxi03.everythingshouldbevirtual.local storageRM: <strong>Write error to fd 6</strong>
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; eventTypeId = <strong>"esx.problem.vmfs.heartbeat.timedout"</strong>,
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; severity = ,
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; message = ,
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; arguments = (vmodl.KeyAnyValue) [
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; (vmodl.KeyAnyValue) {
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; dynamicType = ,
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; key = "1",
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; value = "52db390a-9c1ce512-11a9-e839351020b9",
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; },
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; key = "2",
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; value = (vim.event.DatastoreEventArgument) {
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; dynamicType = ,
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; name = "DataStore_2 (NexentaStor iSCSI)",
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; datastore = 'vim.Datastore:52db390a-9c1ce512-11a9-e839351020b9',
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; },
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; }
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; ],
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; objectId = "52db390a-9c1ce512-11a9-e839351020b9",
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; objectType = "vim.Datastore",
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; objectName = "DataStore_2 (NexentaStor iSCSI)",
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; fault = (vmodl.MethodFault) null,
2014-09-20T00:54:33.182Z esxi03.everythingshouldbevirtual.local Hostd: --&gt; }</pre>
<pre># esxcli storage nmp device list
<strong>naa.600144</strong>f0752f8a00000052db367a0001
   Device Display Name: NEXENTA iSCSI Disk (naa.600144f0752f8a00000052db367a0001)
   Storage Array Type: VMW_SATP_ALUA
   Storage Array Type Device Config: {implicit_support=on;explicit_support=off; explicit_allow=on;alua_followover=on;{TPG_id=0,TPG_state=AO}}
   Path Selection Policy: VMW_PSP_RR
   Path Selection Policy Device Config: {policy=rr,<strong>iops=1000</strong>,bytes=10485760,useANO=0; lastPathIndex=0: NumIOsPending=0,numBytesPending=0}
   Path Selection Policy Device Custom Config: 
   Working Paths: vmhba33:C1:T0:L0, vmhba33:C0:T1:L0
   Is Local SAS Device: false
   Is USB: false
   Is Boot USB Device: false

<strong>naa.600144</strong>f0752f8a00000052e298c60004
   Device Display Name: NEXENTA iSCSI Disk (naa.600144f0752f8a00000052e298c60004)
   Storage Array Type: VMW_SATP_ALUA
   Storage Array Type Device Config: {implicit_support=on;explicit_support=off; explicit_allow=on;alua_followover=on;{TPG_id=0,TPG_state=AO}}
   Path Selection Policy: VMW_PSP_RR
   Path Selection Policy Device Config: {policy=rr,<strong>iops=1000</strong>,bytes=10485760,useANO=0; lastPathIndex=1: NumIOsPending=0,numBytesPending=0}
   Path Selection Policy Device Custom Config: 
   Working Paths: vmhba33:C1:T0:L3, vmhba33:C0:T1:L3
   Is Local SAS Device: false
   Is USB: false
   Is Boot USB Device: false
</pre>
<pre># for i in `esxcfg-scsidevs -c |awk '{print $1}' | grep naa.600144`; do esxcli storage nmp psp roundrobin deviceconfig set --type=iops --iops=1 --device=$i; done</pre>
<pre>esxcli storage nmp device list</pre>
<p>Checking the Delayed ACK setting on the iSCSI HBA. (You will need to change vmhba33 to your iSCSI adapter HBA #, mine is 33 in my setup)</p>
<pre>vmkiscsi-tool -W vmhba33
iSCSI Parameters Setting:
-----------------------------------------------------------------------------------
Parameter                 Min/List        Max             Current         Settable  
-----------------------------------------------------------------------------------
error_recovery_level      0               2               0               No        
init_login_retry_max      0               64              4               No        
init_r2t                  OFF             N/A             OFF             No        
                          ON             
max_outstanding_r2t       1               8               1               Yes       
first_burst_len           512             16777215        262144          Yes       
max_burst_len             512             16777215        262144          Yes       
max_rev_data_seg_len      512             16777215        131072          Yes       
cmds_max                  2               2048            128             No        
immediate_data            OFF             N/A             ON              No        
                          ON             
default_time2wait         0               60              2               No        
default_time2retain       0               60              0               No        
login_timeout             1               60              15              Yes       
logout_timeout            0               60              15              No        
noop_out_interval         1               60              15              Yes       
noop_out_timeout          10              30              10              Yes       
recovery_timeout          1               120             10              Yes       
header_digest             NONE            N/A             NONE            Yes       
                          NONE,CRC32C    
                          CRC32C,NONE    
                          CRC32C         
data_digest               NONE            N/A             NONE            Yes       
                          NONE,CRC32C    
                          CRC32C,NONE    
                          CRC32C         
delayed_ack               OFF             N/A             OFF             Yes       
                          ON             
 - inheritance[:0]:  0x0
 - inheritted parameters:                                     
</pre>
