---
layout: post
title: Homebrew NAS for vSphere - FreeBSD
date: 
type: post
published: false
status: draft
categories: []
tags: []
meta:
  _edit_last: '11'
  snap_MYURL: ''
  snapEdIT: '1'
  snapDL: s:102:"a:1:{i:0;a:3:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";}}";
  snapFB: s:253:"a:1:{i:0;a:8:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapLI: s:246:"a:1:{i:0;a:8:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:0:"";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapSU: s:119:"a:1:{i:0;a:4:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";}}";
  snapTW: 's:172:"a:1:{i:0;a:5:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:42:"%TITLE%
    - %URL% #everythingshouldbevirtual";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";}}";'
  _s2mail: 'yes'
  _wp_rp_related_posts_query_result_cache_expiration: '1426223521'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:3:"699";s:5:"score";s:18:"26.012219262782054";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"3826";s:5:"score";s:18:"23.117300936179706";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:3:"118";s:5:"score";s:17:"20.44944818524875";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"2162";s:5:"score";s:18:"18.669733235499656";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:3:"687";s:5:"score";s:18:"17.298375463530302";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:3:"668";s:5:"score";s:17:"16.18317208667705";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:2:"98";s:5:"score";s:18:"15.693579124898054";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:3:"468";s:5:"score";s:18:"14.578375748044806";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"1695";s:5:"score";s:18:"14.403457136927955";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"1788";s:5:"score";s:18:"13.314410991061672";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"1390";s:5:"score";s:18:"12.542506403179603";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"4115";s:5:"score";s:18:"11.481829527289168";}}
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>In <a title="Homebrew NAS for vSphere" href="http://everythingshouldbevirtual.com/homebrew-nas-vsphere">this</a> previous post I built a Ubuntu NAS using ZFS.</p>
<p>Modify ashift</p>
<pre>vi /etc/sysctl.conf</pre>
<p>Paste the following</p>
<pre># Ensure ZFS uses 4k block size
vfs.zfs.min_auto_ashift=12</pre>
<p>Add to /etc/rc.conf</p>
<pre>vi /etc/rc.conf</pre>
<p>Paste the following</p>
<pre># Enable iSCSI
ctld_enable="YES"

# Setup Networking for vlan(s) and link-aggregation
defaultrouter="10.0.101.1"
cloned_interfaces="lagg0 vlan101 vlan127 vlan128 vlan129 vlan130"
#ifconfig_vlan24="inet 172.16.24.51 netmask 255.255.255.0 vlan 24 vlandev lagg0"
ifconfig_vlan101="inet 10.0.101.51 netmask 255.255.255.0 vlan 101 vlandev lagg0"
ifconfig_vlan127="inet 10.0.127.51 netmask 255.255.255.0 vlan 127 vlandev lagg0"
ifconfig_vlan128="inet 10.0.128.51 netmask 255.255.255.0 vlan 128 vlandev lagg0"
ifconfig_vlan129="inet 10.0.129.51 netmask 255.255.255.0 vlan 129 vlandev lagg0"
ifconfig_vlan130="inet 10.0.130.51 netmask 255.255.255.0 vlan 130 vlandev lagg0"
ifconfig_em0="up"
ifconfig_em1="up"
ifconfig_lagg0="laggproto loadbalance laggport em0 laggport em1"

# Setup NFS Exports
rpcbind_enable="YES"
nfs_server_enable="YES"
#nfs_server_flags="-u -t -n 256"
nfs_server_flags="-u -t"
#mountd_enable="YES"
#mountd_flags="-r"
rpc_lockd_enable="YES"
rpc_statd_enable="YES"

# Setup Remote Syslog
syslogd_enable="YES"
syslogd_flags="-s -v -v"
</pre>
<p>Modify /boot/loader.conf</p>
<pre>vi /boot/loader.conf</pre>
<p>Paste the following</p>
<pre>vfs.zfs.arc_max="10240M"</pre>
