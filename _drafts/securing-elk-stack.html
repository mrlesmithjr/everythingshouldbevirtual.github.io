---
layout: post
title: Securing your ELK stack
date: 
type: post
published: false
status: draft
categories: []
tags: []
meta:
  _edit_last: '11'
  snap_MYURL: ''
  snapEdIT: '1'
  snapDL: s:102:"a:1:{i:0;a:3:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";}}";
  snapFB: s:253:"a:1:{i:0;a:8:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapLI: s:247:"a:1:{i:0;a:8:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapSU: s:119:"a:1:{i:0;a:4:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";}}";
  snapTW: 's:172:"a:1:{i:0;a:5:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:42:"%TITLE%
    - %URL% #everythingshouldbevirtual";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";}}";'
  _s2mail: 'yes'
  _oembed_1b843c8817e0f4893f04799d19fd0fa7: "{{unknown}}"
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>https://github.com/mrlesmithjr/Logstash_Kibana3/blob/master/shell_scripts/secure_kibana_nginx.sh</p>
<p>Add an ELK Admin account without requiring a sudo password.</p>
<pre>sudo adduser elkadmin</pre>
<p>Answer all questions asked and assign password.<br />
Now let's add this user to our sudo allow list to not require a password.</p>
<pre>sudo visudo</pre>
<p>Towards the bottom copy and paste the following.</p>
<pre># Allow elkadmin sudo access without password
elkadmin  ALL=(ALL:ALL) NOPASSWD:ALL</pre>
<p>Now you can use another server as a central management location for your ELK stack.</p>
<pre>ssh-keygen
ssh-copy-id elkadmin@elk-es-1</pre>
<p>Enter the password and then attempt to login using SSH to the new server without having to enter a password.</p>
<pre>ssh elkadmin@elk-es-1</pre>
<p>It should log you in without requiring a password.<br />
Now attempt to use sudo for something and it should work and not prompt for a password.</p>
<pre>sudo apt-get update</pre>
<p>You may be wondering why we are doing this? Doing this will allow us run remote scripts to manage our stack to keep everything in sync and not have to remember which nodes we have already done something on and which ones we have not. We can deploy new logstash.conf files, push out firewall rules, stop|start|restart services, install packages and etc. This also keeps us from enabling SSH allowed logins from root.</p>
<pre># Nginx proxy for Elasticsearch + Kibana
#
# In this setup, we are password protecting the saving of dashboards. You may
# wish to extend the password protection to all paths.
#
# Even though these paths are being called as the result of an ajax request, the
# browser will prompt for a username/password on the first request
#
# If you use this, you'll want to point config.js at http://FQDN:80/ instead of
# http://FQDN:9200
#
#upstream lb_vip {
#       server logstash;
#}

server {
        listen  80;
        return 301 https://logstash;
}

server {
        listen 8080 default_server;

        root /usr/share/nginx/html/kibana;
        index index.html index.htm;

        server_name logstash-1.everythingshouldbevirtual.local;

        location / {
                try_files $uri $uri/ =404;
        }
}
</pre>
