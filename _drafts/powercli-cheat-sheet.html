---
layout: post
title: PowerCLI Cheat Sheet
date: 
type: post
published: false
status: draft
categories: []
tags: []
meta:
  _edit_last: '11'
  _s2mail: 'yes'
  snapEdIT: '1'
  snapFB: s:247:"a:1:{i:0;a:8:{s:4:"doFB";s:1:"1";s:8:"PostType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;}}";
  snapLI: s:246:"a:1:{i:0;a:8:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:6:"&nbsp;";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;}}";
  snapSU: s:119:"a:1:{i:0;a:4:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:4:"nsfw";s:1:"0";}}";
  snapTW: 's:169:"a:1:{i:0;a:5:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:42:"%TITLE%
    - %URL% #everythingshouldbevirtual";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;}}";'
  snap_MYURL: ''
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>I am assuming you have already installed PowerCLI on your admin desktop. There are a couple of ways to start your PowerCLI session:</p>
<p>Method one, double click on the ‘VMware vSphere PowerCLI’ icon that was created on your desktop and you should be started.<br />
Alternative method would be, at the PowerShell command prompt, type:</p>
<pre>Add-PSSnapin VMware.VIMAutomation.Core</pre>
<p>This would load the PowerCLI Snap-in, and in turn allow you to access the vSphere PowerCLI cmdlets.</p>
<p>You can verify if your Snap-in is loaded by using the Get-PSSnapin cmdlet.</p>
<pre>Get-PSSnapin VMware.VIMAutomation.Core</pre>
<p>For regular use, it would make sense to add these to your default PowerShell profile, which can be opened by entering this command from within PowerShell:</p>
<pre>notepad $profile</pre>
<p>This will open a text file containing the custom configuration to run each time a PowerShell session is opened. If you receive an error that the profile file does not exist (i.e. one has not yet been created), a profile file can be simply created via:</p>
<pre>New-Item -Path $profile -ItemType file -Force</pre>
<p>Once you’ve got your profile open, you just need to add this line to it:</p>
<pre>Add-PSSnapin VMware.VimAutomation.Core, VMware.VumAutomation</pre>
<pre>Connect-VIServer -Server vc</pre>
<pre>New-DataCenter -Location Datacenters -Name LAB-DC2</pre>
<p>(Creates new Datacenter)</p>
<pre>New-Cluster –Location LAB-DC2 -Name HA-DRS-DC2 -DRSEnabled –DrsAutomationLevel FullyAutomated –HAEnabled –HAAdmissionControlEnabled</pre>
<pre>Apply-VMHostProfile -AssociateOnly -Entity HA-DRS-DC2 -Profile ESXiLAB</pre>
<pre>Add-VMHost -Server vc -Name 192.168.201.131 -Location HA-DRS-DC2 -User root -Password VMware1! -Force</pre>
<p>Backup Distributed Switch Configuration</p>
<pre>Get-VDSwitch -Name dvswitch | Get-VDPortgroup | Foreach {Export-VDPortGroup -VDPortGroup $_ -Description “Backup of $($_.Name) PG” -Destination “e:\Backups\$($_.Name).Zip”}</pre>
<p>Show powered on vms</p>
<pre>get-vm | where powerstate -eq PoweredOn</pre>
<pre>Get-vm | <b>where</b> { $_.PowerState -eq “PoweredOn”}</pre>
<p>Update VMWare-Tools on all guests</p>
<pre>Get-VM | Update-Tools -NoReboot</pre>
<p>Rescan For new Storage</p>
<pre>Get-Cluster 'HA-DRS-Cluster' | Get-VMHost | Get-VMHostStorage -RescanAllHba -RescanVmfs</pre>
<p>Find VM Snapshots</p>
<pre>Get-VM | Get-Snapshot | select VM, Name, Description, Created</pre>
<p><script type="text/javascript" src="https://gist.github.com/mrlesmithjr/7954983.js">// <![CDATA[<br />
</<br />
// ]]></script></p>
