---
layout: post
title: Quick Script to inject SSH Keys for hostnames and ip address
date: 2015-06-24 13:02:59.000000000 -04:00
type: post
published: true
status: publish
categories:
- Ansible
- Automation
tags:
- Ansible
meta:
  _edit_last: '7644'
  _snap_forceSURL: '2'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:280:"a:1:{i:0;a:9:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  _s2mail: 'yes'
  wp_github_commits_page_fields: a:3:{s:15:"gc_widget_title";s:0:"";s:11:"github_user";s:0:"";s:11:"github_repo";s:0:"";}
  _wp_rp_related_posts_query_result_cache_expiration: '1511362641'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"5057";s:5:"score";s:17:"65.78060702454493";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"5734";s:5:"score";s:17:"65.68302669620607";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"7702";s:5:"score";s:17:"64.08601130378352";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"4934";s:5:"score";s:17:"61.91245564237117";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"4902";s:5:"score";s:17:"60.60260370689167";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"7966";s:5:"score";s:18:"58.867602571573144";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"4962";s:5:"score";s:17:"58.73852552922007";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"7363";s:5:"score";s:17:"56.99541585249871";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"4708";s:5:"score";s:17:"56.77329877904468";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"5462";s:5:"score";s:17:"56.23299959222935";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"4695";s:5:"score";s:17:"53.91906606777738";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"4648";s:5:"score";s:17:"52.88147848085614";}}
  snapLI: s:271:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:8:"postType";s:1:"A";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  snap_isAutoPosted: '1'
  snapDL: s:242:"a:1:{i:0;a:7:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"cc130b03293665d00ebca404baaac552";s:5:"pDate";s:19:"2015-06-24
    17:03:00";}}";
  snapSU: s:304:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"2GRSws";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/2GRSws/comments";s:5:"pDate";s:19:"2015-06-24
    17:03:09";}}";
  snapTW: 's:349:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:93:"%TITLE%
    - %URL% #everythingshouldbevirtual #DevOPS #ansible #rundeck #automation /cc @rundeck";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"613754244013821953";s:5:"pDate";s:19:"2015-06-24
    17:03:09";}}";'
  _wp_rp_image: empty
author:
  login: mrlesmithjr
  email: mrlesmithjr@gmail.com
  display_name: Larry Smith Jr.
  first_name: ''
  last_name: ''
---
<p style="text-align: center;"><strong>Quick Script to inject SSH Keys for hostnames and ip address</strong></p>
<p style="text-align: left;">While playing around with <a href="http://rundeck.org">Rundeck</a> I wanted to run some quick <a href="http://ansible.com">Ansible</a> playbooks. I have not found a good way to integrate Ansible other than running local commands that actually run the playbooks (early learning issue I assume :) ).</p>
<p style="text-align: left;">So with this I had an issue running the Ansible playbooks because of ssh-key's not known. I can successfully run commands within Rundeck to those hosts without issue but when running the Ansible script I ran into the issue. So here I am sharing a script that I created within Rundeck.</p>
<pre>cd /tmp
# create hosts
echo ans-test-1 &gt; hosts
echo ans-test-2 &gt;&gt; hosts
echo ans-test-3 &gt;&gt; hosts
echo ans-test-4 &gt;&gt; hosts
echo ans-test-5 &gt;&gt; hosts
# grab IP addresses from hosts
for node in $(cat hosts); do
  nslookup $node | grep 'Address\:' | awk 'NR==2 {print $2}' &gt;&gt; hosts
done
# add ssh keys for both hostname and ip for each host
for node in $(cat hosts); do
  ssh-keyscan -H $node &gt;&gt; ~/.ssh/known_hosts
done
# Cleanup known_hosts for duplicate entries
sort -u ~/.ssh/known_hosts &gt; ~/.ssh/known_hosts.clean
mv ~/.ssh/known_hosts ~/.ssh/known_hosts.backup
cp ~/.ssh/known_hosts.clean ~/.ssh/known_hosts
# make sure destination exists and is writable for rundeck user... This was erroring out with permission denied for rundeck user.
sudo mkdir /var/lib/rundeck/.ansible/
sudo chown -R rundeck:rundeck /var/lib/rundeck/.ansible/
cd /tmp/ansible
ansible-playbook -i hosts ansible-test.yml --user rundeck
</pre>
<p>Hope this helps someone.<br />
Enjoy!</p>
