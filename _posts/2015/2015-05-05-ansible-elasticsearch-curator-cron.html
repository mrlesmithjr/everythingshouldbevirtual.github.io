---
layout: post
title: Ansible - Elasticsearch Curator Cron
date: 2015-05-05 09:57:14.000000000 -04:00
type: post
published: true
status: publish
categories:
- Ansible
- Automation
- Logstash
- Monitoring
tags:
- Ansible
- elasticsearch
- elk stack
meta:
  _edit_last: '11'
  _snap_forceSURL: '2'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:280:"a:1:{i:0;a:9:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  snapLI: s:274:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  _s2mail: 'yes'
  _yoast_wpseo_focuskw: Ansible - Elasticsearch Curator Cron
  _yoast_wpseo_metadesc: Ansible - Elasticseaarch Curator Cron
  _yoast_wpseo_linkdex: '52'
  snap_isAutoPosted: '1'
  snapDL: s:242:"a:1:{i:0;a:7:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"f70d4cd5b0d7373627085d2640d95594";s:5:"pDate";s:19:"2015-05-05
    13:57:14";}}";
  snapSU: s:304:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"4k2x1P";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/4k2x1P/comments";s:5:"pDate";s:19:"2015-05-05
    13:57:24";}}";
  _wp_rp_related_posts_query_result_cache_expiration: '1509569159'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"4695";s:5:"score";s:18:"116.79279398396372";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"2870";s:5:"score";s:17:"83.50751501584602";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"2985";s:5:"score";s:17:"74.21839586437312";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"2854";s:5:"score";s:17:"74.21839586437312";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"4447";s:5:"score";s:17:"69.62617070759107";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"4449";s:5:"score";s:17:"63.90254658674077";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"5383";s:5:"score";s:17:"56.32701167641626";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"4648";s:5:"score";s:16:"55.7437087624442";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"4968";s:5:"score";s:17:"55.32902934482115";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"6225";s:5:"score";s:18:"54.232373687634365";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"5798";s:5:"score";s:18:"54.232373687634365";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"4944";s:5:"score";s:18:"54.232373687634365";}}
  snapTW: 's:337:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:81:"%TITLE%
    - %URL% #everythingshouldbevirtual #ansible #DevOPS #Automation #Elkstack";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"595588104653668352";s:5:"pDate";s:19:"2015-05-05
    13:57:24";}}";'
  _wp_rp_image: empty
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<h4>Ansible - Elasticsearch Curator Cron</h4>
<p>Just wanted to put this together as I was finally just able to get this working with the newest version of curator. The syntax has changed quite a bit for defining jobs.</p>
<p>Define your curator_max_keep_days and curator_close_after_days variables or accept the default values.</p>
<pre>curator_max_keep_days: 14
curator_close_after_days: 7
</pre>
<pre>---
# Install dependancies
- apt: name=python-pip state=present
 
# Install Curator
- pip: name=elasticsearch-curator
 
- name: remove old curator crontab
  file: path=/etc/cron.d/{{ item }} state=absent
  tags: [cron]
  with_items:
    - 'curator'
    - 'curator_clean'
    - 'curator_close'
    - 'curator_delete'
 
- name: install curator crontab
  cron: name='curator_delete'
        minute='0' hour='10'
        user='root'
        job='/usr/local/bin/curator --host {{ es_fqdn }} delete indices --time-unit days --timestring "\%Y.\%m.\%d" --older-than {{ curator_max_keep_days | default(360) }}'
        cron_file='curator_delete'
        state='present'
  tags: [cron]
 
- name: install curator crontab
  cron: name='curator_close'
        minute='45' hour='9'
        user='root'
        job='/usr/local/bin/curator --host {{ es_fqdn }} close indices --time-unit days --timestring "\%Y.\%m.\%d" --older-than {{ curator_close_after_days | default(14) }}'
        cron_file='curator_close'
        state='present'
  tags: [cron]
</pre>
<p>Enjoy!</p>
