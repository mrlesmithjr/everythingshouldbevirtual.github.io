---
layout: post
title: Learning Vagrant and Ansible Provisioning
date: 2015-08-23 22:05:34.000000000 -04:00
type: post
published: true
status: publish
categories:
- Ansible
- Automation
- Provisioning
- Vagrant
tags:
- Ansible
- vagrant
meta:
  _edit_last: '7644'
  _snap_forceSURL: '2'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:280:"a:1:{i:0;a:9:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  snapSU: s:304:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"1MrQ1R";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/1MrQ1R/comments";s:5:"pDate";s:19:"2015-08-24
    02:05:45";}}";
  _s2mail: 'yes'
  wp_github_commits_page_fields: a:3:{s:15:"gc_widget_title";s:0:"";s:11:"github_user";s:0:"";s:11:"github_repo";s:0:"";}
  _yoast_wpseo_focuskw: Learning Vagrant and Ansible Provisioning
  _yoast_wpseo_metadesc: Learning Vagrant and Ansible Provisioning
  _yoast_wpseo_linkdex: '78'
  snap_isAutoPosted: '1'
  snapDL: s:242:"a:1:{i:0;a:7:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"3cb40fff45f7527ea92c1549108fedaa";s:5:"pDate";s:19:"2015-08-24
    02:05:34";}}";
  snapLI: s:520:"a:1:{i:0;a:13:{s:4:"doLI";s:1:"1";s:8:"postType";s:1:"A";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:19:"6041399722210529280";s:7:"postURL";s:125:"https://www.linkedin.com/updates?discuss=&amp;scope=138895851&amp;stype=M&amp;topic=6041399722210529280&amp;type=U&amp;a=v-vg";s:5:"pDate";s:19:"2015-08-24
    02:05:37";}}";
  _wp_rp_related_posts_query_result_cache_expiration: '1511497113'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"4886";s:5:"score";s:18:"136.18049527074888";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"4915";s:5:"score";s:18:"133.63256491843097";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"4944";s:5:"score";s:17:"129.9938700669502";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"4934";s:5:"score";s:17:"118.4441987139761";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"6225";s:5:"score";s:18:"117.33046920419318";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"4879";s:5:"score";s:18:"117.28256272222612";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"4902";s:5:"score";s:17:"116.6186885599833";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"4962";s:5:"score";s:18:"105.01027304975469";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"5734";s:5:"score";s:17:"100.9556483407024";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"4824";s:5:"score";s:17:"82.66490848765673";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"6033";s:5:"score";s:17:"75.09652921982021";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"5777";s:5:"score";s:17:"62.63185711309633";}}
  snapTW: 's:325:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:69:"%TITLE%
    - %URL% #everythingshouldbevirtual #DevOps #automation #NFD10";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"635634065433997312";s:5:"pDate";s:19:"2015-08-24
    02:05:45";}}";'
  _wp_rp_image: '4827'
author:
  login: mrlesmithjr
  email: mrlesmithjr@gmail.com
  display_name: Larry Smith Jr.
  first_name: ''
  last_name: ''
---
<p style="text-align: center;"><strong>Learning Vagrant and Ansible Provisioning</strong></p>
<p style="text-align: left;">After attending Tech Field Day (#NFD10) there was a great deal of discussion around using Vagrant and Ansible for building out environments and provisioning for testing. After realizing that not everyone was familiar with using either of these so I figured that I would throw together something in hopes of helping out those who are interested in learning about Vagrant and Ansible. My goal in this post is to show how easy it is to spin up a few nodes and begin learning either tool.</p>
<blockquote>
<p style="text-align: center;">***Note - Non-Windows HostOS generally results in a better user experience IMHO...</p>
</blockquote>
<p style="text-align: left;">First head over to the VirtualBox website and install <a href="https://www.virtualbox.org/wiki/Downloads" target="_blank">VirtualBox</a> for your HostOS of choice.</p>
<p style="text-align: left;">Now head over to the Vagrant site and install <a href="https://www.vagrantup.com/downloads.html" target="_blank">Vagrant</a> for your HostOS of choice.</p>
<p style="text-align: left;">Next you will need to install <a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" target="_blank">GIT</a> in order to pull the packages required from GitHub.</p>
<p style="text-align: left;">Now with each of the above installed you are ready to pull down the GitHub repo that I created for learning Vagrant and Ansible. This repo will of course be updated as the need arises. And of course as others consume this and provide feedback.</p>
<pre>git clone https://github.com/mrlesmithjr/vagrant-ansible-template.git
cd vagrant-ansible-template.git
</pre>
<p>Now edit the nodes.yml file to define the nodes to spin up for testing.<br />
The include nodes.yml is as below.</p>
<pre>---
- name: node-1
  box: ubuntu/trusty64
  mem: 512
  cpus: 1
  priv_ip: 192.168.250.101
- name: node-2
  box: ubuntu/trusty64
  mem: 512
  cpus: 1
  priv_ip: 192.168.250.102
</pre>
<p>An example of defining a much different scenario may look like below.</p>
<pre>---
- name: app-1
  box: ubuntu/trusty64
  mem: 512
  cpus: 1
  priv_ip: 192.168.250.101
- name: app-2
  box: ubuntu/trusty64
  mem: 512
  cpus: 1
  priv_ip: 192.168.250.102
- name: web-1
  box: ubuntu/trusty64
  mem: 512
  cpus: 1
  priv_ip: 192.168.250.103
- name: web-2
  box: ubuntu/trusty64
  mem: 512
  cpus: 1
  priv_ip: 192.168.250.104
- name: db-1
  box: ubuntu/trusty64
  mem: 1024
  cpus: 1
  priv_ip: 192.168.250.105
</pre>
<p>Now that you have modified and saved out your new nodes.yml file you are ready to spin it all up.<br />
And this whole environment is as easy as running <strong><em>ONE</em></strong> command.</p>
<pre>vagrant up
</pre>
<p>Sit back and watch your nodes deploy now.</p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2015/08/Screen-Shot-2015-08-23-at-9.38.14-PM.png"><img class="alignnone size-medium wp-image-4805" src="{{ site.baseurl }}/assets/Screen-Shot-2015-08-23-at-9.38.14-PM-300x73.png" alt="Screen Shot 2015-08-23 at 9.38.14 PM" width="300" height="73" /></a></p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2015/08/Screen-Shot-2015-08-23-at-9.39.37-PM.png"><img class="alignnone size-medium wp-image-4806" src="{{ site.baseurl }}/assets/Screen-Shot-2015-08-23-at-9.39.37-PM-246x300.png" alt="Screen Shot 2015-08-23 at 9.39.37 PM" width="246" height="300" /></a></p>
<p>As you can see above the nodes are brought up one by one and an initial Ansible bootstrap (bootstrap.yml) playbook is executed on each node. This playbook is doing a few things for us.</p>
<ul>
<li>Installs Ansible on each node</li>
<li>Installs a few Ansible Galaxy roles (To learn how they can be leveraged in learning)</li>
<li>creates our host_vars/node vars file (So that we can also run ansible on each of our nodes from within the Vagrant node as well)</li>
</ul>
<p>An example of a host_vars file created will look like below.</p>
<pre>---
ansible_ssh_port: 22
ansible_ssh_host: 192.168.250.101
ansible_ssh_private_key_file: .vagrant/machines/app-1/virtualbox/private_key
</pre>
<p>To validate the status of our multi-node environment you run the following.</p>
<pre>vagrant status
</pre>
<p>And you would see something similar to below.</p>
<pre>Current machine states:

app-1                     running (virtualbox)
app-2                     running (virtualbox)
web-1                     running (virtualbox)
web-2                     running (virtualbox)
db-1                      running (virtualbox)
</pre>
<p>An example site.yml playbook using Ansible Galaxy roles is included from the GitHub Repo as well.</p>
<pre>---
- hosts: all
  remote_user: vagrant
  sudo: true
  vars:
  tasks:
  roles:
    - mrlesmithjr.bootstrap
    - mrlesmithjr.base
</pre>
<p>Now if you wanted to run the included site.yml playbook which leverages Ansible Galaxy roles from one of our newly provisioned Vagrant nodes we would do the following.<br />
Connect to one of the newly provisioned nodes. (app-1 in this example)</p>
<pre>vagrant ssh app-1
</pre>
<p>Now there is a synced folder between our HostOS and our Vagrant nodes (/vagrant). This allows us to either modify or create new Ansible roles/plays or tasks which will be synced back and forth.<br />
So to now run our example site.yml we will do the following.</p>
<pre>cd /vagrant
ansible-playbook -i hosts site.yml
</pre>
<p>And again sit back and watch these roles be applied to each node we just spun up.</p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2015/08/Screen-Shot-2015-08-23-at-9.55.58-PM.png"><img class="alignnone size-medium wp-image-4807" src="{{ site.baseurl }}/assets/Screen-Shot-2015-08-23-at-9.55.58-PM-300x161.png" alt="Screen Shot 2015-08-23 at 9.55.58 PM" width="300" height="161" /></a></p>
<p>So there you have it. An easily deployed multi-node environment ready to play in and the sky is the limit on what you can do now to begin your journey learning both of these awesome tools.</p>
<p>And when you are all done you can tear down the environment without losing all of your modifications and/or new Ansible Playbooks. This is now a skeleton structure for you to share with others in order to do some validation or additional tasks.</p>
<p>Tear it down.</p>
<pre>vagrant destroy
</pre>
<p>Enjoy!</p>
<p><a class="twitter-timeline" href="https://twitter.com/hashtag/nfd10" data-widget-id="635621549853310976">#nfd10 Tweets</a><br />
<script>// <![CDATA[<br />
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");<br />
// ]]></script></p>
