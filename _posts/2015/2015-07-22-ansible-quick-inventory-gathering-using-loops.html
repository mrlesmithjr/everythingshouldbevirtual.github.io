---
layout: post
title: Ansible - Quick Inventory Gathering using loops
date: 2015-07-22 17:30:09.000000000 -04:00
type: post
published: true
status: publish
categories:
- Ansible
- Automation
tags:
- Ansible
meta:
  _edit_last: '7644'
  _snap_forceSURL: '2'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:280:"a:1:{i:0;a:9:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  snapLI: s:271:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:8:"postType";s:1:"A";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  _s2mail: 'yes'
  wp_github_commits_page_fields: a:3:{s:15:"gc_widget_title";s:0:"";s:11:"github_user";s:0:"";s:11:"github_repo";s:0:"";}
  snap_isAutoPosted: '1'
  snapDL: s:242:"a:1:{i:0;a:7:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"81dcdf8d64e1c75628a0b6f3a96c3796";s:5:"pDate";s:19:"2015-07-22
    21:30:09";}}";
  snapSU: s:304:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"1fkjgO";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/1fkjgO/comments";s:5:"pDate";s:19:"2015-07-22
    21:30:17";}}";
  _wp_rp_related_posts_query_result_cache_expiration: '1511694221'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"4648";s:5:"score";s:17:"73.24100223122647";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"4621";s:5:"score";s:17:"61.98436805409402";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"7702";s:5:"score";s:17:"57.88898236716871";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"5057";s:5:"score";s:18:"54.032206770650276";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"5462";s:5:"score";s:17:"52.63288304814384";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"4505";s:5:"score";s:17:"51.55868151617061";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"6225";s:5:"score";s:16:"50.8582766575771";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"4962";s:5:"score";s:17:"50.56069918457548";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"4391";s:5:"score";s:17:"50.56069918457548";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"4708";s:5:"score";s:17:"49.64600505044946";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"4879";s:5:"score";s:18:"49.311896881097155";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"4803";s:5:"score";s:18:"49.311896881097155";}}
  snapTW: 's:327:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:71:"%TITLE%
    - %URL% #everythingshouldbevirtual #ansible #automation #devops";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"623968333696647168";s:5:"pDate";s:19:"2015-07-22
    21:30:18";}}";'
  _wp_rp_image: empty
author:
  login: mrlesmithjr
  email: mrlesmithjr@gmail.com
  display_name: Larry Smith Jr.
  first_name: ''
  last_name: ''
---
<p style="text-align: center;"><strong>Ansible - Quick Inventory Gathering using loops</strong></p>
<p style="text-align: left;">I came across this today looking through the Ansible Google groups. The OP wanted something that would output something like below into separate files per inventory hostname.</p>
<pre>Linux ans-test-4 3.13.0-55-generic #92-Ubuntu SMP Sun Jun 14 18:32:20 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 192.168.70.240
nameserver 192.168.70.241
search everythingshouldbevirtual.local
</pre>
<p>The OP was close to having the solution but after a bit of throwing some stuff together below is what ends up getting us what we are looking for. Obviously there are many other ways to pull these sorts of information but trying to stay close to the original question this is what worked.</p>
<pre>---
- hosts: all
  gather_facts: true
  remote_user: remote
  sudo: true
  tasks:
    - name: capture linux_os
      shell: "{{ item }}"
      register: linux_os
      with_items:
        - 'uname -a'
        - 'cat /etc/resolv.conf'

    - name: creating inventory hosts
      file: path="{{ inventory_hostname }}".txt state=touch
      delegate_to: localhost
      sudo: false

    - name: results
      lineinfile: dest="{{ inventory_hostname }}".txt regexp="^{{ item.stdout }}" line="{{ item.stdout }}"
      delegate_to: localhost
      sudo: false
      with_items: linux_os.results
</pre>
<p>Enjoy!</p>
