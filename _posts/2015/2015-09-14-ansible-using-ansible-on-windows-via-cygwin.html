---
layout: post
title: Ansible - Using Ansible on Windows via Cygwin
date: 2015-09-14 10:51:53.000000000 -04:00
type: post
published: true
status: publish
categories:
- Ansible
- Automation
- Windows
tags:
- Ansible
- cygwin
- windows
meta:
  _snap_forceSURL: '2'
  _edit_last: '7644'
  snap_MYURL: ''
  snapEdIT: '1'
  snapFB: s:290:"a:1:{i:0;a:10:{s:4:"doFB";i:0;s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:2:"do";i:0;}}";
  _s2mail: 'yes'
  wp_github_commits_page_fields: a:3:{s:15:"gc_widget_title";s:0:"";s:11:"github_user";s:0:"";s:11:"github_repo";s:0:"";}
  _yoast_wpseo_focuskw: Ansible - Using Ansible on Windows via Cygwin
  _yoast_wpseo_metadesc: Ansible - Using Ansible on Windows via Cygwin
  _yoast_wpseo_linkdex: '69'
  snap_isAutoPosted: '1'
  snapDL: s:370:"a:1:{i:0;a:12:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"f90fcd8217120388eaf2b5dac70fb9fc";s:5:"pDate";s:19:"2015-09-14
    14:51:53";s:2:"do";s:1:"1";s:10:"msgTFormat";s:7:"%TITLE%";s:9:"msgFormat";s:9:"%EXCERPT%";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  snapLI: s:557:"a:1:{i:0;a:15:{s:4:"doLI";i:0;s:8:"postType";s:1:"A";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:19:"6049202718176796672";s:7:"postURL";s:125:"https://www.linkedin.com/updates?discuss=&amp;scope=138895851&amp;stype=M&amp;topic=6049202718176796672&amp;type=U&amp;a=SIY7";s:5:"pDate";s:19:"2015-09-14
    14:51:56";s:2:"do";i:0;s:12:"liMsgFormatT";s:1:" ";}}";
  snapSU: s:429:"a:1:{i:0;a:14:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"1AQVyB";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/1AQVyB/comments";s:5:"pDate";s:19:"2015-09-14
    14:52:03";s:2:"do";s:1:"1";s:9:"msgFormat";s:16:"%TITLE% - %TEXT%";s:5:"suCat";s:2:"IT";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  _wp_rp_related_posts_query_result_cache_expiration: '1511373474'
  _wp_rp_image: empty
  _yoast_wpseo_primary_category: ''
  snapTW: 's:342:"a:1:{i:0;a:10:{s:4:"doTW";i:0;s:10:"SNAPformat";s:76:"%TITLE% -
    %URL% #everythingshouldbevirtual #DevOPS #ansible #Windows #cygwin";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"643437058627735552";s:5:"pDate";s:19:"2015-09-14
    14:52:04";s:2:"do";i:0;}}";'
  catchbox-sidebarlayout: default
  _yoast_wpseo_focuskw_text_input: Ansible - Using Ansible on Windows via Cygwin
  _yoast_wpseo_content_score: '30'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"4962";s:5:"score";s:17:"86.02482163838717";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"5383";s:5:"score";s:17:"55.32902934482115";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"4505";s:5:"score";s:17:"55.32902934482115";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:3:"865";s:5:"score";s:17:"55.02733082662926";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"4934";s:5:"score";s:17:"54.30737809730215";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"4886";s:5:"score";s:17:"54.30737809730215";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"4725";s:5:"score";s:17:"54.30737809730215";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"4695";s:5:"score";s:17:"49.86029432598198";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"4391";s:5:"score";s:17:"49.86029432598198";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"7064";s:5:"score";s:17:"49.55199296634045";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:3:"148";s:5:"score";s:17:"49.14529984508254";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"4713";s:5:"score";s:18:"48.648022718854335";}}
author:
  login: mrlesmithjr
  email: mrlesmithjr@gmail.com
  display_name: Larry Smith Jr.
  first_name: ''
  last_name: ''
---
<p style="text-align: center;"><strong>Ansible - Using Ansible on Windows via Cygwin</strong></p>
<p>As I continue down the Ansible journey to automate all things it is apparent that Windows is a second class citizen in some regards. I had a need to run Ansible from my Windows desktop and figured I would give this a shot. After some searching I found bits and pieces around the google results and pieced this all together and it works. And hopefully someone else will benefit from this.</p>
<p>First we need to install Cygwin from the following <a href="http://cygwin.com/setup-x86_64.exe" target="_blank">x64 (64-Bit)</a> or <a href="http://cygwin.com/setup-x86.exe" target="_blank">x86 (32-Bit)</a>.</p>
<p>Install the following Cygwin components.</p>
<ul>
<li>binutils</li>
<li>curl</li>
<li>gmp</li>
<li>libgmp-devel</li>
<li>make</li>
<li>python (2.7.x)</li>
<li>python-crypto</li>
<li>python-openssl</li>
<li>python-setuptools</li>
<li>git (2.5.x)</li>
<li>nano</li>
<li>openssh</li>
<li>openssl</li>
<li>openssl-devel</li>
</ul>
<p>Once the Cygwin installer completes open the Cygwin desktop shortcut to open up the Cygwin BASH prompt.</p>
<p>There are two ways we can install the following.</p>
<blockquote><p><strong>The first way (more involved). See further down for the easy method.</strong></p></blockquote>
<p>Download the following packages to install.</p>
<pre>curl -O https://pypi.python.org/packages/source/P/PyYAML/PyYAML-3.10.tar.gz
curl -O https://pypi.python.org/packages/source/J/Jinja2/Jinja2-2.8.tar.gz
</pre>
<p>Now extract the packages downloaded above.</p>
<pre>tar -zxvf Jinja2-2.8.tar.gz
tar -zxvf PyYAML-3.10.tar.gz</pre>
<p>Now install the packages downloaded above.</p>
<pre>cd Jinja2-2.8
python setup.py install
cd ..
cd PyYAML-3.10
python setup.py install
</pre>
<blockquote><p><strong>The second way (easy).</strong></p></blockquote>
<pre>easy_install-2.7 pip
CFLAGS="-g -O2 -D_BSD_SOURCE" pip install -U pycrypto
pip install ansible
</pre>
<p>Now let's pull down the Ansible code from GitHub.<em><strong> (More Involved way - see further down for the easy method)</strong></em></p>
<pre>git clone https://github.com/ansible/ansible /opt/ansible
</pre>
<p>Change to the latest stable branch of Ansible.</p>
<pre>cd /opt/ansible
git checkout stable-1.9
</pre>
<p>Now we need to update some of the Ansible modules</p>
<pre>cd /opt/ansible
git submodule update --init lib/ansible/modules/core
git submodule update --init lib/ansible/modules/extras
</pre>
<p>We now need to update our BASH profile to include the path to our Ansible folder.</p>
<pre>cd ~
nano .bashrc
</pre>
<p>Paste the following at the bottom of the file and save.</p>
<pre># Ansible settings
ANSIBLE=/opt/ansible
export PATH=$PATH:$ANSIBLE/bin
export PYTHONPATH=$ANSIBLE/lib
export ANSIBLE_LIBRARY=$ANSIBLE/library
</pre>
<p>Now exit Cygwin</p>
<pre>exit
</pre>
<p>And launch our Cygwin desktop shortcut once again to open up our Cygwin BASH prompt.<br />
You should be able to launch ansible at this point to validate that our profile is correct in seeing the path to Ansible.</p>
<pre>ansible
....
Usage: ansible  [options]

Options:
  -a MODULE_ARGS, --args=MODULE_ARGS
                        module arguments
  --ask-become-pass     ask for privilege escalation password
  -k, --ask-pass        ask for SSH password
  --ask-su-pass         ask for su password (deprecated, use become)
  -K, --ask-sudo-pass   ask for sudo password (deprecated, use become)
  --ask-vault-pass      ask for vault password
  -B SECONDS, --background=SECONDS
                        run asynchronously, failing after X seconds
                        (default=N/A)
  -b, --become          run operations with become (nopasswd implied)
  --become-method=BECOME_METHOD
                        privilege escalation method to use (default=sudo),
                        valid choices: [ sudo | su | pbrun | pfexec | runas ]
  --become-user=BECOME_USER
                        run operations as this user (default=None)
  -C, --check           don't make any changes; instead, try to predict some
                        of the changes that may occur
  -c CONNECTION, --connection=CONNECTION
                        connection type to use (default=smart)
  -e EXTRA_VARS, --extra-vars=EXTRA_VARS
                        set additional variables as key=value or YAML/JSON
  -f FORKS, --forks=FORKS
                        specify number of parallel processes to use
                        (default=5)
  -h, --help            show this help message and exit
  -i INVENTORY, --inventory-file=INVENTORY
                        specify inventory host file
                        (default=/etc/ansible/hosts)
  -l SUBSET, --limit=SUBSET
                        further limit selected hosts to an additional pattern
  --list-hosts          outputs a list of matching hosts; does not execute
                        anything else
  -m MODULE_NAME, --module-name=MODULE_NAME
                        module name to execute (default=command)
  -M MODULE_PATH, --module-path=MODULE_PATH
                        specify path(s) to module library
                        (default=/opt/ansible/library)
  -o, --one-line        condense output
  -P POLL_INTERVAL, --poll=POLL_INTERVAL
                        set the poll interval if using -B (default=15)
  --private-key=PRIVATE_KEY_FILE
                        use this file to authenticate the connection
  -S, --su              run operations with su (deprecated, use become)
  -R SU_USER, --su-user=SU_USER
                        run operations with su as this user (default=root)
                        (deprecated, use become)
  -s, --sudo            run operations with sudo (nopasswd) (deprecated, use
                        become)
  -U SUDO_USER, --sudo-user=SUDO_USER
                        desired sudo user (default=root) (deprecated, use
                        become)
  -T TIMEOUT, --timeout=TIMEOUT
                        override the SSH timeout in seconds (default=10)
  -t TREE, --tree=TREE  log output to this directory
  -u REMOTE_USER, --user=REMOTE_USER
                        connect as this user (default=larry.smith)
  --vault-password-file=VAULT_PASSWORD_FILE
                        vault password file
  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable
                        connection debugging)
  --version             show program's version number and exit
</pre>
<p>BOOM!</p>
<p>Installing Ansible <em><strong>(Easy way)</strong></em></p>
<pre>easy_install-2.7 pip
pip install ansible
</pre>
<p>Now let's do a test download of some Ansible Galaxy roles.</p>
<pre>ansible-galaxy install mrlesmithjr.base
ansible-galaxy install mrlesmithjr.bootstrap
</pre>
<p>Now generate your SSH keys in order to execute ssh-passwordless logins.</p>
<pre>ssh-keygen
</pre>
<p>One more thing that I ran into was when running an ansible-playbook was the following error.</p>
<pre>ansible-playbook -i hosts gather_interfaces.yml
....
PLAY [all] ********************************************************************

GATHERING FACTS ***************************************************************
fatal: [elk-pre-processor-1] =&gt; SSH Error: mux_client_request_session: send fds failed
    while connecting to 10.0.101.91:22
It is sometimes useful to re-run the command using -vvvv, which prints SSH debug output to help diagnose the issue.

TASK: [grabbing interfaces] ***************************************************
FATAL: no hosts matched or all hosts have already failed -- aborting


PLAY RECAP ********************************************************************
           to retry, use: --limit @/home/larry.smith/gather_interfaces.retry

elk-pre-processor-1    : ok=0    changed=0    unreachable=1    failed=0
</pre>
<p>This error above is from using Cygwin and can easily be solved by creating an ansible.cfg file in your playbook folder with the following.</p>
<pre>nano ansible.cfg
....
[ssh_connection]
ssh_args = -o ControlMaster=no
</pre>
<p>Now when running the playbook again success.</p>
<pre>PLAY [all] ********************************************************************

GATHERING FACTS ***************************************************************
ok: [elk-pre-processor-1]

TASK: [grabbing interfaces] ***************************************************
changed: [elk-pre-processor-1]

TASK: [ensuring host_vars exists] *********************************************
ok: [elk-pre-processor-1 -&gt; localhost]

TASK: [configuring host_vars] *************************************************
changed: [elk-pre-processor-1 -&gt; localhost]

PLAY RECAP ********************************************************************
elk-pre-processor-1    : ok=4    changed=2    unreachable=0    failed=0
</pre>
<p>So there you have it! Now happy Ansibling! :) And report back on any of your findings.</p>
<p>Enjoy!</p>
