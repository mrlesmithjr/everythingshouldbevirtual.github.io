---
layout: post
title: Upgrading Ubuntu Nagios 3.5 to 4.x
date: 2013-12-09 12:44:05.000000000 -05:00
type: post
published: true
status: publish
categories:
- Linux
- Monitoring
- Nagios
- Ubuntu
tags:
- nagios
- ubuntu
meta:
  snapFB: s:387:"a:1:{i:0;a:12:{s:4:"doFB";s:1:"1";s:8:"PostType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:31:"389547404477041_509850479113399";s:5:"pDate";s:19:"2013-12-09
    17:44:10";}}";
  snapSU: s:259:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"4okhA5";s:7:"postURL";s:6:"4okhA5";s:5:"pDate";s:19:"2013-12-09
    17:44:19";}}";
  snapTW: 's:295:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:42:"%TITLE%
    - %URL% #everythingshouldbevirtual";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"410102626257477633";s:5:"pDate";s:19:"2013-12-09
    17:44:20";}}";'
  snap_MYURL: ''
  snapEdIT: '1'
  snapLI: s:268:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";}}";
  _s2mail: 'yes'
  _thumbnail_id: '2256'
  snap_isAutoPosted: '1'
  _edit_last: '11'
  _wp_rp_related_posts_query_result_cache_expiration: '1511632592'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:3:"699";s:5:"score";s:17:"131.2023102407661";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"3249";s:5:"score";s:17:"88.74633375936759";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"2626";s:5:"score";s:17:"83.80232726948938";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"1494";s:5:"score";s:17:"81.41449716969854";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"2646";s:5:"score";s:17:"74.63946362190376";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"7243";s:5:"score";s:17:"68.76453111915714";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"2586";s:5:"score";s:17:"68.66194453060281";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"5383";s:5:"score";s:17:"67.98900005736039";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"7208";s:5:"score";s:17:"67.76654878756202";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:3:"878";s:5:"score";s:17:"64.60317278878793";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:3:"729";s:5:"score";s:17:"62.64151428279694";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:3:"527";s:5:"score";s:18:"59.810935336306585";}}
  dsq_thread_id: ''
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>In <a title="http://everythingshouldbevirtual.com/installing-nagios-on-ubuntu-12-04" href="http://everythingshouldbevirtual.com/installing-nagios-on-ubuntu-12-04">this</a> previous post we installed Nagios 3.5.0 from source. Now that the current version of Nagios is 4.0.2 I wanted to walk through upgrading the previous version to the latest.</p>
<pre>sudo bash
apt-get update &amp;&amp; apt-get ugprade
cd /opt
wget http://prdownloads.sourceforge.net/sourceforge/nagios/nagios-4.0.2.tar.gz
wget https://www.nagios-plugins.org/download/nagios-plugins-1.5.tar.gz
tar zxvf nagios-4.0.2.tar.gz
tar zxvf nagios-plugins-1.5.tar.gz
cd nagios-4.0.2
./configure --with-nagios-group=nagios --with-command-group=nagcmd --with-mail=/usr/bin/sendmail
make all
make install
make install-init
make install-config
make install-commandmode
make install-webconf
cp -R contrib/eventhandlers/ /usr/local/nagios/libexec/
chown -R nagios:nagios /usr/local/nagios/libexec/eventhandlers
/usr/local/nagios/bin/nagios -v /usr/local/nagios/etc/nagios.cfg</pre>
<p>If all ran successfully you should see the following.<a href="http://everythingshouldbevirtual.com/wp-content/uploads/2013/12/Screen-Shot-2013-12-09-at-11.51.47-AM.png"><img class="alignnone size-medium wp-image-2255" alt="Screen Shot 2013-12-09 at 11.51.47 AM" src="{{ site.baseurl }}/assets/Screen-Shot-2013-12-09-at-11.51.47-AM-300x278.png" width="300" height="278" /></a></p>
<p>Now let's setup the new Nagios plugins.</p>
<pre>sudo bash
apt-get install daemon
cd /opt/nagios-plugins-1.5
./configure --with-nagios-user=nagios --with-nagios-group=nagios
make
make install</pre>
<p>The new init script installed does not work on Ubuntu so we will remove it and create a new one to run under /etc/init</p>
<pre>rm /etc/init.d/nagios
rm /etc/rcS.d/S99nagios</pre>
<p>Create /etc/init/nagios.conf **Thanks to <a title="http://raymii.org" href="http://raymii.org" target="_blank">raymii.org</a></p>
<pre># nagios - monitoriong system
# by https://raymii.org

description     "nagios monitoring system"

start on virtual-filesystems
stop on runlevel [06]

respawn
respawn limit 5 30
limit nofile 65550 65550

chdir /usr/local/nagios/
setuid nagios
setgid nagios
console log

script
        exec bin/nagios etc/nagios.cfg
end script</pre>
<p>Now you will need to reload the init config to enable nagios</p>
<pre>sudo initctl reload-configuration
sudo start nagios</pre>
<p>So now if all went well and you connect to http://IP|FQDN/nagios and login you should be presented with the following page.<br />
<a href="http://everythingshouldbevirtual.com/wp-content/uploads/2013/12/12-26-24.png"><img class="alignnone size-medium wp-image-2256" alt="12-26-24" src="{{ site.baseurl }}/assets/12-26-24-300x197.png" width="300" height="197" /></a></p>
<p>So there you have it. A few snags in the process but it works.</p>
<p>Enjoy!</p>
