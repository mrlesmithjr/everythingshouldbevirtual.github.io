---
layout: post
title: Dell Perc H310 and NexentaStor
date: 2013-08-11 14:43:00.000000000 -04:00
type: post
published: true
status: publish
categories:
- Nexenta
- Storage
tags:
- h310
- nexenta
meta:
  _edit_last: '11'
  snapEdIT: '1'
  snapFB: s:387:"a:1:{i:0;a:12:{s:4:"doFB";s:1:"1";s:8:"PostType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:31:"389547404477041_457386244359823";s:5:"pDate";s:19:"2013-08-11
    18:43:07";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;}}";
  snapSU: s:232:"a:1:{i:0;a:8:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"1o45MM";s:5:"pDate";s:19:"2013-08-11
    18:43:16";s:4:"nsfw";s:1:"0";}}";
  snapTW: 's:304:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:51:"%TITLE%
    - %URL% #everythingshouldbevirtual #nexenta";s:8:"attchImg";s:1:"0";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"366630916296151043";s:5:"pDate";s:19:"2013-08-11
    18:43:17";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;}}";'
  _s2mail: 'yes'
  _wpas_done_all: '1'
  snap_isAutoPosted: '1'
  snapLI: s:273:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:6:"&nbsp;";s:11:"isPrePosted";s:1:"1";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;}}";
  snap_MYURL: ''
  bwps_enable_ssl: ''
  _wp_rp_related_posts_query_result_cache_expiration: '1512002286'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"1637";s:5:"score";s:17:"70.83983328495532";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"1413";s:5:"score";s:17:"65.62228102201199";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"1196";s:5:"score";s:16:"60.9195305076462";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"1399";s:5:"score";s:17:"56.25524271717502";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"1422";s:5:"score";s:17:"55.98817993196481";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"2162";s:5:"score";s:18:"53.344668252000176";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"1583";s:5:"score";s:18:"53.344668252000176";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"1444";s:5:"score";s:18:"53.344668252000176";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"1016";s:5:"score";s:17:"49.21329752315678";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"3765";s:5:"score";s:15:"48.680380461529";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"2233";s:5:"score";s:15:"48.680380461529";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"1777";s:5:"score";s:15:"48.680380461529";}}
  _wp_rp_image: '3689'
  dsq_thread_id: '3346750561'
  dsq_needs_sync: '1'
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>I have been using Nexenta for several years now of course. Over those years I have been using Supermicro SAS controllers reflashed into IT mode cards so the sata disks will pass through as individual disks. After building out my latest Nexenta build I still had all of the parts from my first build except controller cards. I had been using this hardware for running Hyper-V but I really did not have any need to keep doing any testing with Hyper-V. That of course is for another day. So I had been looking around for some fairly cheap controllers to put in this box so that I could use it for dedicated Veeam backups. The Supermicro controllers that I had been using are about $140/each which is not bad but I wanted to go cheaper if I could. There are a lot of people using IBM M1015, Dell H200, Supermicro and many others. I found some info about the Dell H310 controllers but not a whole lot in regards to using these cards for ZFS specifically with Nexenta. Part of what drove me to these cards is that they are newer than the Dell H200 and cheaper than the H200 and IBM M1015 as well. Mainly because it would appear that most people know about being able to use these cards for ZFS after flashing them so the prices are still rather high. After all each one of these cards are just rebranded LSI controllers anyways. I was able to get two of the H310 controllers off of eBay for $150 including shipping.</p>
<p>So after the cards finally arrived this past week I went ahead and began the process of reflashing them so I could get them into IT mode cards. After I thought I had actually bricked my first card :) I was in business. So the process to get these cards flashed is not too bad but it did have a few gotchas.</p>
<p>Here is what the H310's look like.</p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2013/08/Screen-Shot-2013-08-11-at-2.36.59-PM.png"><img class="alignnone size-medium wp-image-1913" alt="Screen Shot 2013-08-11 at 2.36.59 PM" src="{{ site.baseurl }}/assets/Screen-Shot-2013-08-11-at-2.36.59-PM-300x247.png" width="300" height="247" /></a></p>
<p>So here is the process to reflash the cards into IT mode.</p>
<p>First thing you will need is a bootable MS-DOS thumb drive. Go <a title="http://blogs.technet.com/b/csstwplatform/archive/2012/06/26/how-to-create-a-ms-dos-bootable-usb-flash-drive.aspx" href="http://blogs.technet.com/b/csstwplatform/archive/2012/06/26/how-to-create-a-ms-dos-bootable-usb-flash-drive.aspx" target="_blank">here</a> for info on this.</p>
<p>Grab the IT mode firmware from Dell <a title="http://www.dell.com/support/drivers/us/en/19/DriverDetails/Product/poweredge-r610?DriverId=6M53D&amp;FileId=2731103519&amp;DriverName=Dell%206Gbps%20SAS%20HBA%2C%20v.07.03.05.00%2C%20A08&amp;urlProductCode=False" href="http://www.dell.com/support/drivers/us/en/19/DriverDetails/Product/poweredge-r610?DriverId=6M53D&amp;FileId=2731103519&amp;DriverName=Dell%206Gbps%20SAS%20HBA%2C%20v.07.03.05.00%2C%20A08&amp;urlProductCode=False" target="_blank">here</a>.</p>
<p>Grab <a title="ftp://ftp.supermicro.com/driver/SAS/LSI/2008/iMR/Firmware/Non_Blade/USB.zip" href="ftp://ftp.supermicro.com/driver/SAS/LSI/2008/iMR/Firmware/Non_Blade/USB.zip" target="_blank">this</a> zip file which includes the megarec utility.</p>
<p>You can also grab <a title="http://www.files.laptopvideo2go.com/hdd/sas2008.zip" href="http://www.files.laptopvideo2go.com/hdd/sas2008.zip">this</a> zip file to get the megarec utility along with the sbrempty.bin file.</p>
<p>And now put the files from Dell and the megarec utility on your thumb drive and boot it up. I had to copy the firmware and BIOS files to the root of the thumb drive to work for me so keep that in mind.</p>
<p>Run the following to list your controller cards that are installed in your system.</p>
<pre>megarec -listall
sas2flsh -listall</pre>
<p>The first command "megarec -writesbr 0 sbrempty.bin" wipes the card completely so sas2flsh will recognize the card as an LSI controller. But before you do this like I did. :) Make sure that you get your SAS Controller Address from the card. This card does not have a sticker like other cards do but instead you can list the address by running</p>
<pre>sas2flsh -list</pre>
<p>and write down the SAS address which starts with "500605b". If you don't write it down you are hosed. :) J/K! I thought I was too but I was able to magically come up with a random address starting with "500605b" and writing it to the card. :)</p>
<pre>megarec -writesbr 0 sbrempty.bin
megarec -cleanflash 0</pre>
<p>Now reboot using the USB boot drive again and let's flash the controller with the IT mode firmware.</p>
<pre>sas2flsh -o -f 6gbpsas.fw
sas2flsh -o -b mptsas2.rom
sas2flsh -o -sasadd 500605bxxxxxxxxx</pre>
<p>And that is it. Now reboot and you should see the card initializing again. All done!</p>
<p>One more thing is that you can crossflash these cards to an actual LSI non-Dell firmware as well. I have not done that yet but I may do so soon and will update this post here with any details.</p>
<p>Enjoy!<br />
You can find my other posts about Nexenta by going <a title="http://everythingshouldbevirtual.com/tag/nexenta" href="http://everythingshouldbevirtual.com/tag/nexenta" target="_blank">here</a>.</p>
