---
layout: post
title: Vagrant Box Templates
date: 2016-06-02 23:22:12.000000000 -04:00
type: post
published: true
status: publish
categories:
- Provisioning
- Vagrant
tags:
- vagrant
meta:
  snapTW: 's:316:"a:1:{i:0;a:10:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:42:"%TITLE%
    - %URL% #everythingshouldbevirtual";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:2:"do";s:1:"1";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"738571516598616069";s:5:"pDate";s:19:"2016-06-03
    03:22:26";}}";'
  snap_MYURL: ''
  snapLI: s:290:"a:1:{i:0;a:10:{s:4:"doLI";s:1:"1";s:8:"postType";s:1:"A";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:12:"liMsgFormatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:2:"do";s:1:"1";s:11:"isPrePosted";s:1:"1";}}";
  _yoast_wpseo_focuskw_text_input: Vagrant Box Templates
  _s2mail: 'yes'
  wp_github_commits_page_fields: a:3:{s:15:"gc_widget_title";s:0:"";s:11:"github_user";s:0:"";s:11:"github_repo";s:0:"";}
  snapFB: s:298:"a:1:{i:0;a:10:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:2:"do";s:1:"1";s:11:"isPrePosted";s:1:"1";}}";
  snapEdIT: '1'
  snapDL: s:229:"a:1:{i:0;a:8:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";s:2:"do";s:1:"1";s:10:"msgTFormat";s:7:"%TITLE%";s:9:"msgFormat";s:9:"%EXCERPT%";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";}}";
  _snap_forceSURL: '2'
  _edit_last: '7644'
  _yoast_wpseo_primary_category: '431'
  snap_isAutoPosted: '1'
  snapSU: s:402:"a:1:{i:0;a:13:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:2:"do";s:1:"1";s:9:"msgFormat";s:16:"%TITLE% - %TEXT%";s:5:"suCat";s:2:"IT";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"Aiux2Q";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/Aiux2Q/comments";s:5:"pDate";s:19:"2016-06-03
    03:22:26";}}";
  _yoast_wpseo_focuskw: Vagrant Box Templates
  _yoast_wpseo_linkdex: '77'
  _wp_rp_related_posts_query_result_cache_expiration: '1509481735'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"4824";s:5:"score";s:17:"84.99641167065522";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"4915";s:5:"score";s:17:"84.35950420841814";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"4886";s:5:"score";s:17:"75.09652921982021";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"4803";s:5:"score";s:17:"75.09652921982021";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"4962";s:5:"score";s:17:"73.10056455607801";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"6225";s:5:"score";s:17:"71.32595816543335";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"4902";s:5:"score";s:17:"70.32797583383824";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:4:"4944";s:5:"score";s:17:"68.43212019946981";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"4934";s:5:"score";s:17:"67.43413786787468";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"4879";s:5:"score";s:17:"64.02464168284587";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"5777";s:5:"score";s:17:"53.66695328296222";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"5734";s:5:"score";s:18:"47.363619131969855";}}
  _wp_rp_image: empty
author:
  login: mrlesmithjr
  email: mrlesmithjr@gmail.com
  display_name: Larry Smith Jr.
  first_name: ''
  last_name: ''
---
<p style="text-align: center;"><strong>Vagrant Box Templates</strong></p>
<p style="text-align: left;">Over the past few months I have been putting together some Vagrant box templates based on different Linux distros all using Packer. My goal is to have a standard methodology for building them as well as consuming them. In this post I want to share those templates with others as well as share some little tricks I have learned for myself that have proven to be extremely useful.</p>
<p style="text-align: left;">List of current Vagrant box templates</p>
<ul>
<li style="text-align: left;">Alpine Linux</li>
<li style="text-align: left;">CentOS-6</li>
<li style="text-align: left;">CentOS-7</li>
<li style="text-align: left;">Debian Jessie (server)</li>
<li style="text-align: left;">Debian Jessie (desktop)</li>
<li style="text-align: left;">Debian Wheezy</li>
<li style="text-align: left;">Fedora 22</li>
<li style="text-align: left;">Fedora 23</li>
<li style="text-align: left;">LinuxMint 17 (cinnamon)</li>
<li style="text-align: left;">OpenSuse 42.1</li>
<li style="text-align: left;">Ubuntu Precise</li>
<li style="text-align: left;">Ubuntu Trusty</li>
<li style="text-align: left;">Ubuntu Vivid</li>
<li style="text-align: left;">Ubuntu Wily</li>
<li style="text-align: left;">Ubuntu Xenial</li>
</ul>
<p>You can check out the actual Vagrant boxes on Hashicorp's Atlas site <a href="https://atlas.hashicorp.com/mrlesmithjr">here</a>.</p>
<p>I have also been saving these as templates on GitHub which also includes a consistent and customizable Vagrantfile for each distro ready for consumption. You can check these out on GitHub <a href="https://github.com/mrlesmithjr/vagrant-box-templates">here</a>.</p>
<p>And if you are interested in pulling these templates down from GitHub to start leveraging you can do so by doing the following...</p>
<pre>git clone https://github.com/mrlesmithjr/vagrant-box-templates.git
</pre>
<p>Now you are ready to begin spinning these environments up the way they are or you can tweak the Vagrantfile to fit your testing scenario(s).</p>
<p>Below is an example of what the Vagrantfile currently looks like for Ubuntu Xenial.</p>
<pre># -*- mode: ruby -*-
# vi: set ft=ruby :

# All Vagrant configuration is done below. The "2" in Vagrant.configure
# configures the configuration version (we support older styles for
# backwards compatibility). Please don't change it unless you know what
# you're doing.

# ---- Define number of nodes to spin up ----
N = 1

# ---- Define any custom memory/cpu requirement ----
# if custom requirements are desired...ensure to set
# custom_cpu_mem == "yes" otherwise set to "no"
# By default if custom requirements are defined and set below
# any node not defined will be configured as the default...
# which is 1vCPU/512mb...So if setting custom requirements
# only define any node which requires more than the defaults.
nodes = [
  {
    :node =&gt; "node0",
    :cpu =&gt; 1,
    :mem =&gt; 4096
  }
]

# ---- Define variables below ----
additional_disks = "no"  #Define if additional drives defined should be added (yes | no)
additional_disks_controller = "SATA Controller"
additional_disks_num = 1  #Define the number of additional disks to add
additional_disks_size = 10  #Define disk size in GB
additional_nics = "no"  #Define if additional network adapters should be created (yes | no)
additional_nics_num = 1  #Define the number of additional nics to add
box = "mrlesmithjr/xenial64"  #Define Vagrant box to load
custom_cpu_mem = "no"  #Define if custom cpu and memory requirements are needed (yes| no)...defined within nodes variable above
desktop = "no"  #Define if running desktop OS (yes | no)
enable_port_forwards = "no"  #Define if port forwards should be enabled
linked_clones = "no"  #Defines if nodes should be linked from master VM (yes | no)
port_forwards = [
  {
    :node =&gt; "node0",
    :guest =&gt; 80,
    :host =&gt; 8080
  }
]
provision_nodes = "no"  #Define if provisioners should run (yes | no)
server_cpus = 1  #Define number of CPU cores...will be ignored if custom_cpu_mem == "yes"
server_memory = 512  #Define amount of memory to assign to node(s)...will be ignored if custom_cpu_mem == "yes"
subnet = "192.168.202."  #Define subnet for private_network
subnet_ip_start = 200  #Define starting last octet of the subnet range to begin addresses for node(s)

Vagrant.configure(2) do |config|

  #Iterate over nodes
  (1..N).each do |node_id|
    nid = (node_id - 1)

    config.vm.define "node#{nid}" do |node|
      node.vm.box = box
      node.vm.provider "virtualbox" do |vb|
        if linked_clones == "yes"
          vb.linked_clone = true
        end
        if custom_cpu_mem == "no"
          vb.customize ["modifyvm", :id, "--cpus", server_cpus]
          vb.customize ["modifyvm", :id, "--memory", server_memory]
        end
        if custom_cpu_mem == "yes"
          nodes.each do |cust_node|
            if cust_node[:node] == "node#{nid}"
              vb.customize ["modifyvm", :id, "--cpus", cust_node[:cpu]]
              vb.customize ["modifyvm", :id, "--memory", cust_node[:mem]]
            end
          end
        end
        if desktop == "yes"
          vb.gui = true
          vb.customize ["modifyvm", :id, "--graphicscontroller", "vboxvga"]
          vb.customize ["modifyvm", :id, "--accelerate3d", "on"]
          vb.customize ["modifyvm", :id, "--ioapic", "on"]
          vb.customize ["modifyvm", :id, "--vram", "128"]
          vb.customize ["modifyvm", :id, "--hwvirtex", "on"]
        end
        if additional_disks == "yes"
          (1..additional_disks_num).each do |disk_num|
            dnum = (disk_num + 1)
            ddev = ("node#{nid}_Disk#{dnum}.vdi")
            unless File.exist?("#{ddev}")
              vb.customize ['createhd', '--filename', ("#{ddev}"), '--variant', 'Fixed', '--size', additional_disks_size * 1024]
            end
            vb.customize ['storageattach', :id,  '--storagectl', "#{additional_disks_controller}", '--port', dnum, '--device', 0, '--type', 'hdd', '--medium', "node#{nid}_Disk#{dnum}.vdi"]
          end
        end
      end
      node.vm.hostname = "node#{nid}"

      ### Define additional network adapters below
      if additional_nics == "yes"
        (1..additional_nics_num).each do |nic_num|
          nnum = Random.rand(0..50)
          node.vm.network :private_network, ip: subnet+"#{subnet_ip_start + nid + nnum}"
        end
      end

      ### Define port forwards below
      if enable_port_forwards == "yes"
        port_forwards.each do |pf|
          if pf[:node] == "node#{nid}"
            node.vm.network "forwarded_port", guest: pf[:guest], host: pf[:host] + nid
          end
        end
      end
      if provision_nodes == "yes"
        if node_id == N
          node.vm.provision "ansible" do |ansible|  #runs bootstrap Ansible playbook
            ansible.limit = "all"
            ansible.playbook = "bootstrap.yml"
          end
          node.vm.provision "ansible" do |ansible|  #runs Ansible playbook for installing roles/executing tasks
            ansible.limit = "all"
            ansible.playbook = "playbook.yml"
            ansible.groups = {
              "test-nodes" =&gt; [
                "node0"
              ]
            }
          end
        end
      end

    end
  end
  if provision_nodes == "yes"
    config.vm.provision :shell, path: "bootstrap.sh", keep_color: "true"  #runs initial shell script
  end
end
</pre>
<p>So there you have it...Just find the environment that you would like to spin up and give it a go.</p>
<p>Enjoy!</p>
