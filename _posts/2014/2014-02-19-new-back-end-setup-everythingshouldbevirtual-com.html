---
layout: post
title: New Back-end Setup for EverythingShouldBeVirtual.com
date: 2014-02-19 21:51:33.000000000 -05:00
type: post
published: true
status: publish
categories:
- Announcements
tags: []
meta:
  _edit_last: '11'
  snap_MYURL: ''
  snapEdIT: '1'
  snapLI: s:268:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";}}";
  _s2mail: 'yes'
  snap_isAutoPosted: '1'
  snapFB: s:387:"a:1:{i:0;a:12:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:31:"389547404477041_543525035745943";s:5:"pDate";s:19:"2014-02-20
    02:51:35";}}";
  snapSU: s:304:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"5Zz39v";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/5Zz39v/comments";s:5:"pDate";s:19:"2014-02-20
    02:51:45";}}";
  snapTW: 's:295:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:42:"%TITLE%
    - %URL% #everythingshouldbevirtual";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"436332298083254272";s:5:"pDate";s:19:"2014-02-20
    02:51:45";}}";'
  _thumbnail_id: '2405'
  _wp_rp_related_posts_query_result_cache_expiration: '1510315819'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:3:"699";s:5:"score";s:18:"31.659776024787767";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"4391";s:5:"score";s:18:"31.314553162956663";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"4588";s:5:"score";s:17:"22.43459272075036";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:3:"133";s:5:"score";s:18:"21.253592987335445";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"2854";s:5:"score";s:18:"21.055229161868922";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"2469";s:5:"score";s:17:"20.85767800002182";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"1713";s:5:"score";s:17:"20.85767800002182";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:3:"729";s:5:"score";s:17:"20.40192816569752";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"3302";s:5:"score";s:17:"17.01469923405357";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:3:"253";s:5:"score";s:17:"17.01469923405357";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"2509";s:5:"score";s:18:"16.864570235851605";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:4:"2164";s:5:"score";s:18:"16.864570235851605";}}
  dsq_thread_id: '3346750769'
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>So after running this blog on a single server running within an <a title="http://www.ispconfig.org/" href="http://www.ispconfig.org/" target="_blank">ISPConfig </a>setup for quite some time I have finally redesigned the back-end (it has taken a good week getting it to where it is now). This was basically due to the fact that I have started getting a lot more traffic and I needed the ability to scale better. So far this new setup has proven to be very good, even though there have been a few gotchas along the way. And there will be many things I will still be stumbling across as I get more traffic. I do appreciate those who have let me know when something is not working correctly which I have corrected along the way.</p>
<ul>
<li>For the edge I am still using a <a title="http://pfsense.org/" href="http://pfsense.org/" target="_blank">PFSense </a>dedicated server as my firewall.</li>
<li>For load balancing I am using a pair of<a title="https://www.citrix.com/downloads/netscaler-adc/virtual-appliances/netscaler-vpx-express.html" href="https://www.citrix.com/downloads/netscaler-adc/virtual-appliances/netscaler-vpx-express.html" target="_blank"> Citrix VPX Express Netscaler's</a> HA clustered. I am using LeastConnection policy and CookieInsert for persistence.</li>
<li>For my web server's I am using a pair of Apache Web Servers running on Ubuntu 12.04 x64. All /var/www content is being synced between them by using a <a title="http://www.cis.upenn.edu/~bcpierce/unison/" href="http://www.cis.upenn.edu/~bcpierce/unison/" target="_blank">Unison</a> replication that runs every minute. I have also setup each server with a 64MB <a title="http://memcached.org/" href="http://memcached.org/">Memcached</a> Cache which is shared between each server. I also installed the <a title="http://pecl.php.net/package/memcached" href="http://pecl.php.net/package/memcached" target="_blank">PECL memcached extension</a>. For Wordpress to utilize this I used this <a title="http://svn.wp-plugins.org/memcached/trunk/" href="http://svn.wp-plugins.org/memcached/trunk/" target="_blank">drop-in</a> and then setup <a title="http://wordpress.org/plugins/batcache/installation/" href="http://wordpress.org/plugins/batcache/installation/" target="_blank">batcache</a> drop-in.</li>
<li>For my MySQL DB Server's I am running a pair of MySQL Server's running on Ubuntu 12.04 x64. These are setup in an Active/Active Master-Master mode. Make sure to setup the following in your my.cnf when doing this or you will get duplicate entries in your DB and it sucks. <a title="https://www.digitalocean.com/community/articles/how-to-set-up-mysql-master-master-replication" href="https://www.digitalocean.com/community/articles/how-to-set-up-mysql-master-master-replication" target="_blank">Here</a> is a great writeup on doing this.<br />
Node-1</p>
<pre>server-id		= 1
auto-increment-offset	= 1
auto-increment-increment	= 4</pre>
<p>Node-2</p>
<pre>server-id		= 2
auto-increment-offset	= 2
auto-increment-increment	= 4</pre>
</li>
</ul>
<p style="text-align: center;">Below is a quick drawing of what this all looks like.</p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2014/02/Netscaler-Apache-MySQL.png"><img class="size-medium wp-image-2405 aligncenter" alt="Netscaler-Apache-MySQL" src="{{ site.baseurl }}/assets/Netscaler-Apache-MySQL-300x231.png" width="300" height="231" /></a></p>
<p>And here are some memcached stats after running for a day.<a href="http://everythingshouldbevirtual.com/wp-content/uploads/2014/02/18-13-32.png"><img class="alignnone size-medium wp-image-2441" alt="18-13-32" src="{{ site.baseurl }}/assets/18-13-32-300x180.png" width="300" height="180" /></a></p>
<p>Enjoy!</p>
