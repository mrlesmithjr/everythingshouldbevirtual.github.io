---
layout: post
title: HAProxy and MySQL Checks
date: 2014-12-17 23:18:14.000000000 -05:00
type: post
published: true
status: publish
categories:
- Networking
tags:
- haproxy
- mysql
meta:
  _edit_last: '11'
  snap_MYURL: ''
  snapEdIT: '1'
  snapDL: s:242:"a:1:{i:0;a:7:{s:4:"doDL";s:1:"1";s:11:"SNAPformatT";s:7:"%TITLE%";s:10:"SNAPformat";s:9:"%EXCERPT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:32:"b5250b666b738e4f0ecf16d8d04bf14d";s:5:"pDate";s:19:"2014-12-18
    04:18:15";}}";
  snapTW: 's:322:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:66:"%TITLE%
    - %URL% #everythingshouldbevirtual #Ubuntu #haproxy #mysql";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"545432905087193088";s:5:"pDate";s:19:"2014-12-18
    04:18:33";}}";'
  _s2mail: 'yes'
  _yoast_wpseo_focuskw: HAProxy and MySQL Checks
  _yoast_wpseo_metadesc: HAProxy and MySQL Checks
  _yoast_wpseo_linkdex: '61'
  snap_isAutoPosted: '1'
  snapFB: s:280:"a:1:{i:0;a:9:{s:4:"doFB";s:1:"1";s:8:"postType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  snapLI: s:274:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";s:0:"";s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";s:0:"";s:11:"isPrePosted";s:1:"1";}}";
  _wp_rp_related_posts_query_result_cache_expiration: '1511547083'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"4449";s:5:"score";s:17:"61.39243152089922";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"2854";s:5:"score";s:16:"58.2699598993356";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"2985";s:5:"score";s:17:"53.05272729152964";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"3793";s:5:"score";s:17:"27.27904910114711";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"4297";s:5:"score";s:18:"25.644335004696252";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"1695";s:5:"score";s:18:"23.458148905898117";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"1402";s:5:"score";s:18:"23.458148905898117";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:3:"909";s:5:"score";s:18:"23.035530718563702";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"4420";s:5:"score";s:17:"17.95437730236238";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:4:"1819";s:5:"score";s:16:"17.7676543772182";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:3:"913";s:5:"score";s:18:"17.664376028154308";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:3:"471";s:5:"score";s:18:"17.664376028154308";}}
  snapSU: s:304:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"3027eF";s:7:"postURL";s:50:"http://www.stumbleupon.com/content/3027eF/comments";s:5:"pDate";s:19:"2014-12-18
    04:18:32";}}";
  dsq_thread_id: ''
  _wp_rp_image: empty
  _oembed_e66359a7ec199ca308a1cda7d197bd70: "{{unknown}}"
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<h4>HAProxy and MySQL Checks</h4>
<p>I wanted to throw this out in case anyone else has a need for such a setup to use L7 for node up/down when load balancing MySQL with HAProxy.<br />
All you have to do is run the following script. Copy the content below into <em>setup_chkmysql.sh</em></p>
<pre>nano setup_chkmysql.sh</pre>
<p>Copy contents from below, save and exit.</p>
<pre>chmod +x setup_chkmysql.sh
sudo ./setup_chkmysql.sh</pre>
<p>https://gist.github.com/mrlesmithjr/1f59a493674cafcc22cc</p>
<p>Now add the following for you haproxy.cfg file on your load balancer.</p>
<pre>frontend mysql-3306
        bind 192.168.1.71:3306  
        mode tcp
        log global
        option tcplog
        timeout client 60000ms
        default_backend mysql_tcp

backend mysql_tcp
        balance leastconn
        timeout connect 60000ms
        timeout server 60000ms
        option httpchk
        option allbackups
        default-server port 9200 inter 2s downinter 5s rise 3 fall 2 slowstart 60s maxconn 256 maxqueue 128 weight 100
        server galera-1 galera-1.everythingshouldbevirtual.local:3306 check
        server galera-2 galera-2.everythingshouldbevirtual.local:3306 check
        server galera-3 galera-3.everythingshouldbevirtual.local:3306 check
</pre>
<p>Enjoy!</p>
