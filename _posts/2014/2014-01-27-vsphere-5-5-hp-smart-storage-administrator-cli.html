---
layout: post
title: vSphere 5.5 - HP Smart Storage Administrator CLI - Emulate SSD
date: 2014-01-27 16:33:35.000000000 -05:00
type: post
published: true
status: publish
categories:
- HP
- Storage
- Virtualization
- VMware
- VMware vSAN
- vSphere 5.5
tags:
- HP
- ssd
- vsan
meta:
  _yoast_wpseo_linkdex: '72'
  _edit_last: '11'
  snap_MYURL: ''
  snapEdIT: '1'
  snapLI: s:268:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";}}";
  snapSU: s:259:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"2ehwe4";s:7:"postURL";s:6:"2ehwe4";s:5:"pDate";s:19:"2014-01-27
    21:33:47";}}";
  bwps_enable_ssl: ''
  _s2mail: 'yes'
  snapTW: 's:310:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:57:"%TITLE%
    - %URL% #everythingshouldbevirtual #vSphere #vsan";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"427917377154465792";s:5:"pDate";s:19:"2014-01-27
    21:33:47";}}";'
  _yoast_wpseo_focuskw: vsphere 5.5
  snap_isAutoPosted: '1'
  snapFB: s:410:"a:1:{i:0;a:13:{s:4:"doFB";s:1:"1";s:8:"PostType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:31:"389547404477041_532412673523846";s:5:"pDate";s:19:"2014-01-27
    21:33:37";s:8:"postType";s:1:"T";}}";
  _wp_rp_image: '3409'
  _wp_rp_related_posts_query_result_cache_expiration: '1511818409'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"2156";s:5:"score";s:17:"95.24734124956262";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"2123";s:5:"score";s:17:"89.45356837181882";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"1196";s:5:"score";s:16:"87.9245386046803";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:3:"755";s:5:"score";s:17:"82.11902212679863";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:4:"1444";s:5:"score";s:17:"71.02171000137199";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"1556";s:5:"score";s:17:"70.80043090376068";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:3:"923";s:5:"score";s:17:"68.09315375209074";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:3:"199";s:5:"score";s:17:"67.33146682312966";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"2509";s:5:"score";s:17:"65.15708132780526";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:3:"162";s:5:"score";s:17:"61.45035236650801";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"1553";s:5:"score";s:17:"54.70853251675963";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:3:"471";s:5:"score";s:17:"53.55905059720104";}}
  dsq_thread_id: ''
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>So I was sitting around over the weekend and decided I wanted to mess around with vSAN in a non nested environment for a bit and started going over some options I had without a big expense for now and this is what I came up with. Now I am using some HP DL360 G5 vSphere 5.5 hosts and had a handful of 146GB SAS drives laying around so I figured why not give this a shot. Overall it worked just fine for theory testing but not for any real IO performance by any means.</p>
<p>Launch the HP Smart Storage Administrator CLI</p>
<pre>./opt/hp/hpssacli/bin/hpssacli</pre>
<p>List all controllers and disks configurations</p>
<pre>=&gt; ctrl all show config

Smart Array P400i in Slot 0 (Embedded)    (sn: PH8AMQ2553     )

   array A (SAS, Unused Space: 0  MB)

      logicaldrive 1 (68.3 GB, RAID 1, OK)

      physicaldrive 1I:1:1 (port 1I:box 1:bay 1, SAS, 72 GB, OK)
      physicaldrive 1I:1:2 (port 1I:box 1:bay 2, SAS, 72 GB, OK)

   unassigned

      physicaldrive 1I:1:3 (port 1I:box 1:bay 3, SAS, 146 GB, OK)
      physicaldrive 1I:1:4 (port 1I:box 1:bay 4, SAS, 146 GB, OK)
      physicaldrive 2I:1:5 (port 2I:box 1:bay 5, SAS, 146 GB, OK)
      physicaldrive 2I:1:6 (port 2I:box 1:bay 6, SAS, 146 GB, OK)</pre>
<p>Create individual Raid-0 disks using the unassigned drives.</p>
<pre>=&gt; ctrl slot=0 create type=ld drives=1I:1:3 raid=0 ss=64 size=max aa=disable"</pre>
<p>List all controllers and disks once again</p>
<pre>=&gt; ctrl all show config

Smart Array P400i in Slot 0 (Embedded)    (sn: PH8AMQ2553     )

   array A (SAS, Unused Space: 0  MB)

      logicaldrive 1 (68.3 GB, RAID 1, OK)

      physicaldrive 1I:1:1 (port 1I:box 1:bay 1, SAS, 72 GB, OK)
      physicaldrive 1I:1:2 (port 1I:box 1:bay 2, SAS, 72 GB, OK)

   array B (SAS, Unused Space: 0  MB)

      logicaldrive 2 (136.7 GB, RAID 0, OK)

      physicaldrive 1I:1:3 (port 1I:box 1:bay 3, SAS, 146 GB, OK)

   unassigned

      physicaldrive 1I:1:4 (port 1I:box 1:bay 4, SAS, 146 GB, OK)
      physicaldrive 2I:1:5 (port 2I:box 1:bay 5, SAS, 146 GB, OK)
      physicaldrive 2I:1:6 (port 2I:box 1:bay 6, SAS, 146 GB, OK)</pre>
<p>You should now see array B which is the Raid-0 logical drive we just created.<br />
We will now create additional Raid-0 logical drives with our remaining phyiscal drives that are unassigned.</p>
<pre>=&gt; ctrl slot=0 create type=ld drives=1I:1:4 raid=0 ss=64 size=max aa=disable"
=&gt; ctrl slot=0 create type=ld drives=2I:1:5 raid=0 ss=64 size=max aa=disable"
=&gt; ctrl slot=0 create type=ld drives=2I:1:6 raid=0 ss=64 size=max aa=disable"</pre>
<p>List all controllers and disks once again.</p>
<pre>=&gt; ctrl all show config

Smart Array P400i in Slot 0 (Embedded)    (sn: PH8AMQ2553     )

   array A (SAS, Unused Space: 0  MB)

      logicaldrive 1 (68.3 GB, RAID 1, OK)

      physicaldrive 1I:1:1 (port 1I:box 1:bay 1, SAS, 72 GB, OK)
      physicaldrive 1I:1:2 (port 1I:box 1:bay 2, SAS, 72 GB, OK)

   array B (SAS, Unused Space: 0  MB)

      logicaldrive 2 (136.7 GB, RAID 0, OK)

      physicaldrive 1I:1:3 (port 1I:box 1:bay 3, SAS, 146 GB, OK)

   array C (SAS, Unused Space: 0  MB)

      logicaldrive 3 (136.7 GB, RAID 0, OK)

      physicaldrive 1I:1:4 (port 1I:box 1:bay 4, SAS, 146 GB, OK)

   array D (SAS, Unused Space: 0  MB)

      logicaldrive 4 (136.7 GB, RAID 0, OK)

      physicaldrive 2I:1:5 (port 2I:box 1:bay 5, SAS, 146 GB, OK)

   array E (SAS, Unused Space: 0  MB)

      logicaldrive 5 (136.7 GB, RAID 0, OK)

      physicaldrive 2I:1:6 (port 2I:box 1:bay 6, SAS, 146 GB, OK)</pre>
<p>Unfortunately I am using an HP P400i controller so a reboot is still required. :(</p>
<p>Now that we have rebooted our host we are now going to emulate one of these newly created Raid-0 logicaldrives as an SSD.</p>
<p>Now you will need to identify the one that you want to use for our emulated SSD and we can do this by listing all of our local devices using the following command. You should also verify using the webui to make sure we identify the correct device.</p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2014/01/Screen-Shot-2014-01-25-at-10.11.49-PM.png"><img class="alignnone size-medium wp-image-2320" alt="Screen Shot 2014-01-25 at 10.11.49 PM" src="{{ site.baseurl }}/assets/Screen-Shot-2014-01-25-at-10.11.49-PM-300x213.png" width="300" height="213" /></a></p>
<pre># esxcli storage core device list | grep mpx
mpx.vmhba1:C0:T2:L0
   Display Name: Local VMware Disk (mpx.vmhba1:C0:T2:L0)
   Devfs Path: /vmfs/devices/disks/mpx.vmhba1:C0:T2:L0
mpx.vmhba1:C0:T1:L0
   Display Name: Local VMware Disk (mpx.vmhba1:C0:T1:L0)
   Devfs Path: /vmfs/devices/disks/mpx.vmhba1:C0:T1:L0
mpx.vmhba1:C0:T0:L0
   Display Name: Local VMware Disk (mpx.vmhba1:C0:T0:L0)
   Devfs Path: /vmfs/devices/disks/mpx.vmhba1:C0:T0:L0
mpx.vmhba1:C0:T4:L0
   Display Name: Local VMware Disk (mpx.vmhba1:C0:T4:L0)
   Devfs Path: /vmfs/devices/disks/mpx.vmhba1:C0:T4:L0
mpx.vmhba0:C0:T0:L0
   Display Name: Local HL-DT-ST CD-ROM (mpx.vmhba0:C0:T0:L0)
   Devfs Path: /vmfs/devices/cdrom/mpx.vmhba0:C0:T0:L0
mpx.vmhba1:C0:T3:L0
   Display Name: Local VMware Disk (mpx.vmhba1:C0:T3:L0)
   Devfs Path: /vmfs/devices/disks/mpx.vmhba1:C0:T3:L0</pre>
<p>We are going to use mpx.vmhba1:C0:T1:L0 as the logicaldrive to emulate as an SSD. In order to emulate an SSD we need to create a SATP rule. Run the following commands to do so.</p>
<pre>esxcli storage nmp satp rule add --satp VMW_SATP_LOCAL --device mpx.vmhba1:C0:T1:L0 --option=enable_ssd
esxcli storage core claiming reclaim -d mpx.vmhba1:C0:T1:L0</pre>
<p>Now rescan your devices on your array controller and you will see that the device is now listed as an SSD device.</p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2014/01/Screen-Shot-2014-01-25-at-10.13.57-PM.png"><img class="alignnone size-medium wp-image-2321" alt="Screen Shot 2014-01-25 at 10.13.57 PM" src="{{ site.baseurl }}/assets/Screen-Shot-2014-01-25-at-10.13.57-PM-300x92.png" width="300" height="92" /></a></p>
<p>If you want to remove this SATP rule you can run the following commands to do so.</p>
<pre>esxcli storage nmp satp rule remove --satp VMW_SATP_LOCAL --device mpx.vmhba1:C0:T1:L0 --option=enable_ssd
esxcli storage core claiming reclaim -d mpx.vmhba1:C0:T1:L0</pre>
<p>Now it will no longer show the device as SSD.</p>
<p>Congratulations you now have an emulated SSD drive and some additional Raid-0 devices so you can test vSAN, vSphere Flash Read Cache, PernixData or anything else as well. But of course do not expect great performance from this method as this will not even compare to the performance of a true SSD drive. However, you will be able to test some of these products without the need of purchasing an expensive SSD drive. And by no means is this method at all recommended for a production environment. And my initial testing of vSAN has proven to be terrible performance using this method. So keep that in mind!</p>
<p>Enjoy!</p>
