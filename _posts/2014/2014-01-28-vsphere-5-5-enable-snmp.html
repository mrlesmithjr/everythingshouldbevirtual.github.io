---
layout: post
title: vSphere 5.5 - Enable SNMP
date: 2014-01-28 14:54:19.000000000 -05:00
type: post
published: true
status: publish
categories:
- Monitoring
- PowerCLI
- Virtualization
- VMware
- vSphere 5.5
tags:
- esxi
- powercli
- snmp
- vpshere
meta:
  _edit_last: '11'
  _thumbnail_id: '2330'
  snap_MYURL: ''
  snapEdIT: '1'
  bwps_enable_ssl: ''
  _s2mail: 'yes'
  snapLI: s:268:"a:1:{i:0;a:9:{s:4:"doLI";s:1:"1";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:41:"New
    post has been published on %SITENAME%";s:11:"SNAPformatT";s:1:" ";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";}}";
  snap_isAutoPosted: '1'
  snapSU: s:259:"a:1:{i:0;a:9:{s:4:"doSU";s:1:"1";s:7:"apSUCat";s:2:"IT";s:4:"nsfw";s:1:"0";s:10:"SNAPformat";s:16:"%TITLE%
    - %TEXT%";s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:6:"1fV0OV";s:7:"postURL";s:6:"1fV0OV";s:5:"pDate";s:19:"2014-01-28
    19:54:28";}}";
  snapTW: 's:304:"a:1:{i:0;a:9:{s:4:"doTW";s:1:"1";s:10:"SNAPformat";s:51:"%TITLE%
    - %URL% #everythingshouldbevirtual #vsphere";s:8:"attchImg";s:1:"0";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:18:"464225581849382912";s:5:"pDate";s:19:"2014-05-08
    02:09:38";}}";'
  snapFB: s:410:"a:1:{i:0;a:13:{s:4:"doFB";s:1:"1";s:8:"PostType";s:1:"A";s:10:"AttachPost";s:1:"1";s:10:"SNAPformat";s:51:"New
    post (%TITLE%) has been published on %SITENAME%";s:9:"isAutoImg";s:1:"A";s:8:"imgToUse";b:0;s:9:"isAutoURL";s:1:"A";s:8:"urlToUse";b:0;s:11:"isPrePosted";s:1:"1";s:8:"isPosted";s:1:"1";s:4:"pgID";s:31:"389547404477041_532848556813591";s:5:"pDate";s:19:"2014-01-28
    19:54:20";s:8:"postType";s:1:"A";}}";
  _wp_rp_related_posts_query_result_cache_expiration: '1511702944'
  _wp_rp_related_posts_query_result_cache_6: a:12:{i:0;O:8:"stdClass":2:{s:7:"post_id";s:4:"2280";s:5:"score";s:18:"116.72745271389783";}i:1;O:8:"stdClass":2:{s:7:"post_id";s:4:"3114";s:5:"score";s:17:"102.4114764485434";}i:2;O:8:"stdClass":2:{s:7:"post_id";s:4:"2156";s:5:"score";s:17:"95.23140920955632";}i:3;O:8:"stdClass":2:{s:7:"post_id";s:4:"2314";s:5:"score";s:17:"77.47063861586084";}i:4;O:8:"stdClass":2:{s:7:"post_id";s:3:"148";s:5:"score";s:17:"61.10243024639894";}i:5;O:8:"stdClass":2:{s:7:"post_id";s:4:"5485";s:5:"score";s:17:"58.50798454746045";}i:6;O:8:"stdClass":2:{s:7:"post_id";s:4:"2586";s:5:"score";s:18:"54.890173472038995";}i:7;O:8:"stdClass":2:{s:7:"post_id";s:3:"497";s:5:"score";s:18:"53.456297551247985";}i:8;O:8:"stdClass":2:{s:7:"post_id";s:4:"1402";s:5:"score";s:17:"52.33215799735011";}i:9;O:8:"stdClass":2:{s:7:"post_id";s:3:"747";s:5:"score";s:18:"48.363164899986714";}i:10;O:8:"stdClass":2:{s:7:"post_id";s:4:"1282";s:5:"score";s:18:"46.750229802488136";}i:11;O:8:"stdClass":2:{s:7:"post_id";s:3:"487";s:5:"score";s:17:"46.59172161391349";}}
  dsq_thread_id: ''
  dsq_needs_sync: '1'
author:
  login: larry.e.smith.jr
  email: larry.e.smith.jr@gmail.com
  display_name: mrlesmithjr
  first_name: Larry
  last_name: Smith
---
<p>I am going through setting up Solarwinds Virtual Manager and needed to enable SNMP on my vSphere 5.5 hosts. So the service set to automatically start but it will not start without generating an error when attempting to start the service as seen below.</p>
<p><a href="http://everythingshouldbevirtual.com/wp-content/uploads/2014/01/14-28-44.png"><img class="alignnone size-medium wp-image-2330" src="{{ site.baseurl }}/assets/14-28-44-300x284.png" alt="14-28-44" width="300" height="284" /></a></p>
<p>So in case you run into the same thing it is as simple as running the following commands on your individual hosts from a console session. Replace YOUR_STRING with the community string that you would like to use. The last command sets the firewall to allow all to poll SNMP.</p>
<pre>esxcli system snmp set --communities YOUR_STRING
esxcli system snmp set --enable true
esxcli network firewall ruleset set --ruleset-id snmp --allowed-all true
esxcli network firewall ruleset set --ruleset-id snmp --enabled true
/etc/init.d/snmpd restart</pre>
<p>You can change the firewall rule to only allow a specific subnet or host if you would like to.</p>
<pre>esxcli network firewall ruleset set --ruleset-id snmp --allowed-all false
esxcli network firewall ruleset allowedip add --ruleset-id snmp --ip-address 10.0.101.0/24
esxcli network firewall ruleset set --ruleset-id snmp --enabled true
/etc/init.d/snmpd restart</pre>
<p>So you are thinking well that is great but I have more than just a few hosts and would like to run this using PowerCLI. So here you go, a bit of PowerCLI to set your SNMP up on each of your hosts in vCenter.</p>
<pre># PowerCLI Script for adding syslogserver to hosts
# @mrlesmithjr
# EverythingShouldBeVirtual.com
# Change the following to match your environment
# vi_server is your vCenter
$vi_server = “vcenterservername”
$vcuser = "vcenterserverusername"
$vcpass = "vcenterserverpassword"
$communities = "public"
$syslocation = "Atlanta"

Connect-VIServer -Server $vi_server -User $vcuser -Password $vcpass

# Setup variable to use in script for all hosts in vCenter
$vmhosts = @(Get-VMHost)

# Configure syslog on each host in vCenter
foreach ($vmhost in $vmhosts) {
Write-Host ‘$vmhost = ‘ $vmhost
$esxcli = Get-EsxCli -VMHost $vmhost
$esxcli.system.snmp.set($null,$communities,"true",$null,$null,$null,$null,$null,$null,$null,$null,$null,$syslocation)
$esxcli.system.snmp.get()
}

Disconnect-VIServer * -Confirm:$false</pre>
<p>So there you have it. You are good to go now. Have fun SNMP'ing away!<br />
Enjoy!</p>
